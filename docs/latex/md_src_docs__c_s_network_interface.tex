\hypertarget{md_src_docs__c_s_network_interface_autotoc_md1}{}\doxysubsection{Summary}\label{md_src_docs__c_s_network_interface_autotoc_md1}
The Command\+Station-\/\+EX \mbox{\hyperlink{class_network_interface}{Network\+Interface}} provides Ethernet and/or Wi\+Fi capabilities to Command\+Station-\/\+EX. It supports T\+CP as well as U\+DP for sending data containing Command\+Station\+EX recognized protocols i.\+e. J\+M\+RI or Wi\+Throttle. Those commands can be transfered either as raw text or over H\+T\+TP.

For more information about Command\+Station-\/\+EX can be found on \href{https://github.com/DCC-EX/CommandStation-EX}{\texttt{ github}} or on the \href{https://dcc-ex.com/}{\texttt{ dcc-\/ex}} website\hypertarget{md_src_docs__c_s_network_interface_autotoc_md2}{}\doxysubsection{Features}\label{md_src_docs__c_s_network_interface_autotoc_md2}
\hypertarget{md_src_docs__c_s_network_interface_autotoc_md3}{}\doxysubsubsection{Networking}\label{md_src_docs__c_s_network_interface_autotoc_md3}

\begin{DoxyItemize}
\item {\bfseries{Network types supported}} \+: Ethernet and Wi\+Fi
\item {\bfseries{Network protocol support}} \+: T\+CP and U\+DP
\item {\bfseries{Application \mbox{\hyperlink{class_transport}{Transport}} protcols}} \+: Raw text and H\+T\+TP; H\+T\+T\+PS for the E\+SP only and M\+Q\+TT are to be done;
\item {\bfseries{Application Payload -\/ Command\+Station EX protocols}}\+: J\+M\+RI format as well as Wit\+Hrottle
\end{DoxyItemize}\hypertarget{md_src_docs__c_s_network_interface_autotoc_md4}{}\doxysubsubsection{Wi\+Fi}\label{md_src_docs__c_s_network_interface_autotoc_md4}
\hypertarget{md_src_docs__c_s_network_interface_autotoc_md5}{}\doxysubsubsection{Ethernet}\label{md_src_docs__c_s_network_interface_autotoc_md5}

\begin{DoxyItemize}
\item Automatic detection of the Ethernet\+Shield capabilities and number of possible concurrent connections for T\+CP
\item U\+DP will have only one connection available as its a non-\/connected stateless protocol and all clients will use the same connection
\item Etheret and Wi\+Fi can be mixed if a Ether\+Net Shield and E\+SP are both connected to the M\+CU
\end{DoxyItemize}

The interface also supports multiple connections on different ports for T\+CP and U\+DP. You can also mix Ethernet and Wifi ( my setup has actually both connected currently ) Wi\+Throttle over U\+DP should also support multiple clients as i know the remote IP and ports to reply to to the contrary of T\+CP as a connected protocol but that i can\textquotesingle{}t test yet\hypertarget{md_src_docs__c_s_network_interface_autotoc_md6}{}\doxysubsubsection{Diagnostics}\label{md_src_docs__c_s_network_interface_autotoc_md6}
\hypertarget{md_src_docs__c_s_network_interface_autotoc_md7}{}\doxysubsubsection{Dependencies}\label{md_src_docs__c_s_network_interface_autotoc_md7}

\begin{DoxyItemize}
\item Wi\+Fi The Wi\+Fi connection makes use of the Wi\+Fi\+Esp\+AT library from Juraj Andr√°ssy which can be found here\+: \href{https://github.com/jandrassy/WiFiEspAT}{\texttt{ github}}. This library requires that the E\+SP, providing the Wi\+Fi hardware, supports an AT commandset version 1.\+7 or 2.\+1 as of today. All different E\+SP modules should be supported. Unfortunatley most E\+SP modules shipped today come with an older AT commandset installed by default. Therfore flashing your E\+SP may be required. Plans exist to build our own E\+SP Wi\+Fi AT library also supporting older AT commandsets. This library is available from the P\+IO library manager as well as from the Arduino I\+DE library manager. Please refer to the platformio.\+ini file on how to use the library. Using V\+SC together with P\+IO, instead of looking for the libary in P\+IO library manager, can just add the relevant file in your platformio.\+ini file and the compiler will find and download if required the library for you.
\end{DoxyItemize}

Instructions for flashing your E\+SP can be found here\+: to be done\hypertarget{md_src_docs__c_s_network_interface_autotoc_md8}{}\doxysubsubsection{Command\+Station E\+X Integration}\label{md_src_docs__c_s_network_interface_autotoc_md8}
There are some code changes in the Command\+Station EX code required which may be integrated into master eventually;


\begin{DoxyItemize}
\item Include files
\item Ring\+Buffer
\end{DoxyItemize}\hypertarget{md_src_docs__c_s_network_interface_autotoc_md9}{}\doxysubsubsection{Throttles}\label{md_src_docs__c_s_network_interface_autotoc_md9}
\hypertarget{md_src_docs__c_s_network_interface_autotoc_md10}{}\doxysubsubsection{Telnet}\label{md_src_docs__c_s_network_interface_autotoc_md10}
\hypertarget{md_src_docs__c_s_network_interface_autotoc_md11}{}\doxysubsection{Setup}\label{md_src_docs__c_s_network_interface_autotoc_md11}
In \mbox{\hyperlink{_network_config_8h}{Network\+Config.\+h}} \+: uncomment \#define D\+C\+C\+\_\+\+E\+N\+A\+B\+L\+ED; If that is commented out the \mbox{\hyperlink{class_network_interface}{Network\+Interface}} runs standalone Once \mbox{\hyperlink{class_network_interface}{Network\+Interface}} is part of the Command\+Station EX master this step has been done already\hypertarget{md_src_docs__c_s_network_interface_autotoc_md12}{}\doxysubsection{Attention Points}\label{md_src_docs__c_s_network_interface_autotoc_md12}

\begin{DoxyItemize}
\item Memory Consumption\+: Every network interface instatiated will consume valuable memory/processing time needed also by other parts of the Command\+Station. It is recommended to instantiate at most 2. If you don\textquotesingle{}t have enough memory for Accessiries, Sensors, Turnouts etc. please look if one network interface would be sufficient.
\item For Wi\+Fi you need to reserve Serial 1 fo the connection to the E\+SP due to a limitation from the Wi\+Fi\+A\+T\+Esp library. Otehrwise you could use Software\+Serial (less recommended/feature has to be added)
\item U\+NO is not supported due to ressource limitation. An Arduino Mega is required.
\item Individual commands send shall not be longer than half of the M\+A\+X\+\_\+\+E\+T\+H\+\_\+\+B\+U\+F\+F\+ER size in order to make sure that no command which spans two recieved packets is lost. The default settings should be sufficient for most use cases.
\end{DoxyItemize}\hypertarget{md_src_docs__c_s_network_interface_autotoc_md13}{}\doxysubsection{Roadmap}\label{md_src_docs__c_s_network_interface_autotoc_md13}

\begin{DoxyItemize}
\item Allow user defined application payload protocols
\item Integrate M\+Q\+TT as an application transport protocol
\item Add Software\+Serial to add the Wi\+Fi E\+SP
\item AP Access mode for Wi\+Fi
\item Reset persistent Wi\+Fi credentials
\end{DoxyItemize}\hypertarget{md_src_docs__c_s_network_interface_autotoc_md14}{}\doxysubsection{Example .\+ino file for setting up the Network\+Interface}\label{md_src_docs__c_s_network_interface_autotoc_md14}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <Arduino.h>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "\mbox{\hyperlink{_d_i_a_g_8h}{DIAG.h}}"}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "\mbox{\hyperlink{free_memory_8h}{freeMemory.h}}"}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// (0) Include the header file}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "\mbox{\hyperlink{_network_interface_8h}{NetworkInterface.h}}"}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// (1) Declare NetworkInterfaces; Two interfaces have been defined here}}
\DoxyCodeLine{\mbox{\hyperlink{class_network_interface}{NetworkInterface}} nwi1;}
\DoxyCodeLine{\mbox{\hyperlink{class_network_interface}{NetworkInterface}} nwi2;}
\DoxyCodeLine{\textcolor{comment}{// (1) Declared NetworkInterfaces}}
\DoxyCodeLine{\textcolor{comment}{// (2) Start NetworkInterface -\/ HTTP callback}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void} httpRequestHandler(\mbox{\hyperlink{struct_parsed_request}{ParsedRequest}} *req, Client* client) \{}
\DoxyCodeLine{  \mbox{\hyperlink{_d_i_a_g_8h_ad2390c07b2f83f490ae971a3fdc0c18b}{DIAG}}(F(\textcolor{stringliteral}{"\(\backslash\)nParsed Request:"}));}
\DoxyCodeLine{  \mbox{\hyperlink{_d_i_a_g_8h_ad2390c07b2f83f490ae971a3fdc0c18b}{DIAG}}(F(\textcolor{stringliteral}{"\(\backslash\)nMethod:         [\%s]"}), req-\/>\mbox{\hyperlink{struct_parsed_request_af4e4790d8f338e78c3e6720c0397e490}{method}});}
\DoxyCodeLine{  \mbox{\hyperlink{_d_i_a_g_8h_ad2390c07b2f83f490ae971a3fdc0c18b}{DIAG}}(F(\textcolor{stringliteral}{"\(\backslash\)nURI:            [\%s]"}), req-\/>\mbox{\hyperlink{struct_parsed_request_aa969118960d665d3a2f8aa27a41f0000}{uri}});}
\DoxyCodeLine{  \mbox{\hyperlink{_d_i_a_g_8h_ad2390c07b2f83f490ae971a3fdc0c18b}{DIAG}}(F(\textcolor{stringliteral}{"\(\backslash\)nHTTP version:   [\%s]"}), req-\/>\mbox{\hyperlink{struct_parsed_request_afaa2d1cf6fbfdde289b6b3ac438f8340}{version}});}
\DoxyCodeLine{  \mbox{\hyperlink{_d_i_a_g_8h_ad2390c07b2f83f490ae971a3fdc0c18b}{DIAG}}(F(\textcolor{stringliteral}{"\(\backslash\)nParameter count:[\%d]\(\backslash\)n"}), *req-\/>\mbox{\hyperlink{struct_parsed_request_aaf34b6d32d4b9d20253c4bace7f9fc76}{paramCount}});}
\DoxyCodeLine{\}}
\DoxyCodeLine{\textcolor{comment}{// (2) End NetworkInterface -\/ HTTP callback}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void} setup()}
\DoxyCodeLine{\{}
\DoxyCodeLine{  \textcolor{comment}{// The main sketch has responsibilities during setup()}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Responsibility 1: Start the usb connection for diagnostics}}
\DoxyCodeLine{  \textcolor{comment}{// This is normally Serial but uses SerialUSB on a SAMD processor}}
\DoxyCodeLine{}
\DoxyCodeLine{  Serial.begin(115200);}
\DoxyCodeLine{  \mbox{\hyperlink{_d_i_a_g_8h_ad2390c07b2f83f490ae971a3fdc0c18b}{DIAG}}(F(\textcolor{stringliteral}{"DCC++ EX NetworkInterface Standalone"}));}
\DoxyCodeLine{  }
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// (3) Start NetworkInterface -\/ The original WifiInterface is still there but disabled}}
\DoxyCodeLine{}
\DoxyCodeLine{  \mbox{\hyperlink{_d_i_a_g_8h_ad2390c07b2f83f490ae971a3fdc0c18b}{DIAG}}(F(\textcolor{stringliteral}{"\(\backslash\)nFree RAM before network init: [\%d]\(\backslash\)n"}),\mbox{\hyperlink{free_memory_8cpp_a8d862dc01c44bfabc8d952bb77f8da89}{freeMemory}}());}
\DoxyCodeLine{  \mbox{\hyperlink{_d_i_a_g_8h_ad2390c07b2f83f490ae971a3fdc0c18b}{DIAG}}(F(\textcolor{stringliteral}{"\(\backslash\)nNetwork Setup In Progress ...\(\backslash\)n\(\backslash\)n"}));}
\DoxyCodeLine{  }
\DoxyCodeLine{  nwi1.\mbox{\hyperlink{class_network_interface_a8f05744c8bc994934df83686131bbc63}{setup}}(\mbox{\hyperlink{_network_interface_8h_a59eb013c6734195b94b275310e167df1a8f0fce6ed9d0370f45ef72a7b469937c}{ETHERNET}}, \mbox{\hyperlink{_network_interface_8h_af6adf0e71a06d4619216ff5e60479530aa040cd7feeb588104634cdadf35abf1c}{TCP}}, 8888);               \textcolor{comment}{// ETHERNET/TCP on Port 8888}}
\DoxyCodeLine{  nwi1.\mbox{\hyperlink{class_network_interface_ac131f1227aa4e746238686378e9ddff4}{setHttpCallback}}(httpRequestHandler);      \textcolor{comment}{// HTTP callback}}
\DoxyCodeLine{}
\DoxyCodeLine{  nwi2.\mbox{\hyperlink{class_network_interface_a8f05744c8bc994934df83686131bbc63}{setup}}(\mbox{\hyperlink{_network_interface_8h_a59eb013c6734195b94b275310e167df1a13e02909006158bf407b1093191dcf5b}{WIFI}}, \mbox{\hyperlink{_network_interface_8h_af6adf0e71a06d4619216ff5e60479530aa040cd7feeb588104634cdadf35abf1c}{TCP}});                         \textcolor{comment}{// WIFI/TCP on Port 2560}}
\DoxyCodeLine{  }
\DoxyCodeLine{}
\DoxyCodeLine{  \mbox{\hyperlink{_d_i_a_g_8h_ad2390c07b2f83f490ae971a3fdc0c18b}{DIAG}}(F(\textcolor{stringliteral}{"\(\backslash\)nNetwork Setup done ...\(\backslash\)n"}));}
\DoxyCodeLine{  \mbox{\hyperlink{_d_i_a_g_8h_ad2390c07b2f83f490ae971a3fdc0c18b}{DIAG}}(F(\textcolor{stringliteral}{"\(\backslash\)nFree RAM after network init: [\%d]\(\backslash\)n"}),\mbox{\hyperlink{free_memory_8cpp_a8d862dc01c44bfabc8d952bb77f8da89}{freeMemory}}());}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// (2) End starting NetworkInterface}}
\DoxyCodeLine{}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void} loop()}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// (3) Start Loop NetworkInterface }}
\DoxyCodeLine{\mbox{\hyperlink{class_network_interface_a16289c91bcd5e48a00ad6fe5e8f0a2ad}{NetworkInterface::loop}}();}
\DoxyCodeLine{\textcolor{comment}{// (3) End Loop NetworkInterface}}
\DoxyCodeLine{  }
\DoxyCodeLine{\}}
\end{DoxyCode}
 